<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pvz2 lvl randomizer</title>
    <style>
        body {
            display: flex;
            flex-direction: column; /* Add this to stack elements vertically */
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
    
        button {
            padding: 10px 20px;
            font-size: 16px;
        }
    
        /* Add this to create space above the select */
    </style>
</head>
<body>
    <div>
        <button onclick="display()">Copy.</button>
        <button onclick="downloadFile()">Download.</button>
    </div>
    <div style="display: flex; align-items: center;">
        <select id="filename"></select>
        <input style="width: 40px;" value="1" type="number" min="1" max="32" id="levelnum">
        <pre>.json</pre>
    </div>






    <script>
let interval = randint(7,10);
let flags = randint(1,3);
let total = interval * flags;


let specials = [
"future_protector","dark_wizard","dark_juggler","dark_king","beach_octopus",
"iceage_hunter","iceage_dodo","iceage_weaselhoarder","iceage_troglobite",
"camel_onehump","camel_twohump","camel_manyhump","pharaoh","ra","tomb_raiser",
"explorer","barrelroller","cannon","seagull","pirate_captain","swashbuckler",
"lostcity_impporter","lostcity_excavator","lostcity_jane","lostcity_bug","lostcity_bug_armor1",
"lostcity_bug_armor2","lostcity_crystalskull","lostcity_relichunter",
"eighties_boombox","dino_bully","modern_newspaper","modern_balloon","modern_allstar",
"prospector","west_bull","poncho","piano","chicken_farmer","mech_cone","football_mech","disco_mech","future_jetpack",
];
let basics = ["tutorial","mummy","pirate","cowboy","future","dark","beach","iceage","lostcity","eighties","dino"];
let flyingUnits = ["lostcity_bug_armor2","lostcity_bug_armor1","modern_balloon","tutorial_balloon","future_jetpack_veteran","future_jetpack","pelican","cannon","lostcity_bug"];

let stage = ["Egypt","Pirate","West","Future","Dark","Beach","Iceage","Lostcity","Eighties","Dino","FrontLawn"];

for (let i = 0; i < stage.length - 1; i++) {
    let option = document.createElement('option');
    let select = document.getElementById('filename');
    let txt = stage[i];
    debugger;
    if (i == 2){txt = 'Cowboy'}
    option.setAttribute('value', txt);
    option.text = txt;
    select.appendChild(option);
}

stage[stage.length - 3] = stage[stage.length - 2];
stage[stage.length - 2] = stage[stage.length - 1];
stage.pop();

stage = choice(stage);

let pool = sample(specials,randint(2,4));

pool.push(choice(basics));
pool.push(choice(basics) + '_armor2');
pool.push(choice(basics) + '_armor2');





function choice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function sample(arr, k) {
    let result = [];
    for(let i = 0; i < k; i++) {
        let randIndex = Math.floor(Math.random() * arr.length);
        result.push(arr[randIndex]);
        arr.splice(randIndex, 1);
    }
    return result;
}

function randint(min, max) {
  return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function randBool() {
    return Math.random() >= 0.5;
}

var level = new Object();
var objects = new Array();
var objdata = new Object();
var waveManager = new Object();
let escalation = new Object();

waveManager.FlagWaveInterval = interval;
waveManager.WaveCount = total;
waveManager.SuppressFlagZombie = false;
waveManager.Waves = waveArray();

function waveArray() {
    let emptyWave = [];
    let waveOfEmptyWaves = [];
    for (let i = 0; i < total; i++) {
        waveOfEmptyWaves.push(emptyWave);
    }
    return waveOfEmptyWaves;
}

escalation.FlagCount = flags;
escalation.WavesPerFlag = interval;
escalation.PlantfoodToSpawnCount = randint(0,5);
escalation.StartingPoints = randint(4,10) * 25;
escalation.PointIncrementPerWave = randint(4,8) * 25;
escalation.WaveManagerProps = "RTID(WaveManager@CurrentLevel)";
escalation.ZombiePool = pool;

var modules = [];

function append(objdata,objclass,alias) {
    let obj = new Object();
    if (!(alias === undefined)){
        obj.aliases = [alias];
        modules.push(`RTID(${alias}@.)`);
    }
    obj.objclass = objclass;
    obj.objdata = objdata;
    objects.push(obj);
}


modules.push("RTID(StandardIntro@LevelModules)");
modules.push("RTID(ZombiesDeadWinCon@LevelModules)");
modules.push("RTID(DefaultZombieWinCondition@LevelModules)");
if (randBool()){
    modules.push(`RTID(${stage}Mowers@LevelModules)`)
}

objdata.StartingSun = randint(0,4) * 25;
objdata.Description = "my randomized level";
objdata.Loot = "RTID(DefaultLoot@LevelModules)";
objdata.Modules = modules;
objdata.Name = "My Level";
objdata.StageModule = `RTID(${stage}Stage@LevelModules)`;

append(objdata,'LevelDefinition');
append({"SelectionMethod": "chooser"},"SeedBankProperties","SeedBank");
append({},"WaveManagerModuleProperties","NewWaves");
append(escalation,"LevelEscalationModuleProperties","Escalation");
append(waveManager,"WaveManagerProperties","WaveManagerProps");

level.objects = objects;
level.version = 1;

switch (stage) {
    case 'Pirate':
        append({"PlankRows":sample([0,1,2,3,4],randint(1,5)).sort()},"PiratePlankProperties","PiratePlanks");
        pool.push(...sample(flyingUnits,randint(2,4)));
        break;
    default:
        break;
}

for (let i = 0; i < pool.length; i++) {
    pool[i] = `RTID(${pool[i]}@ZombieTypes)`;
}
function display() {
    const text = JSON.stringify(level, null, 2); // Converts the object to a formatted JSON string
    navigator.clipboard.writeText(text);
    if (confirm("level's code succesfully copied.")) {
    location.reload();
    }
}

function downloadFile() {
    // Create a Blob from the text
    text = JSON.stringify(level, null, 2);
    var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
    debugger;
    let filename = document.getElementById('filename').value;
    filename += document.getElementById('levelnum').value + '.json';
    console.log(filename);
    // Create a URL representing the text
    var url = URL.createObjectURL(blob);
    
    // Create a hidden anchor element
    var a = document.createElement("a");
    a.style.display = "none";
    a.href = url;
    a.download = filename;
    
    // Append the anchor to the body
    document.body.appendChild(a);
    
    // Simulate a click to start the download
    a.click();
    
    // Clean up by removing the anchor
    document.body.removeChild(a);
    
    // Revoke the URL
    URL.revokeObjectURL(url);
}




























    </script>
</body>
</html>